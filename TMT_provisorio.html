<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- jsPsych library -->
    <script src="jspsych-6.3.0/jspsych.js"></script>

    <!-- SVG.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.3/svg.min.js"></script>

    <!-- jsPsych plugins-->
    <script src="jspsych-6.3.0/plugins/jspsych-fullscreen.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-canvas-button-response-modified.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-virtual-chinrest.js"></script>
    <link rel="stylesheet" href="jspsych-6.3.0\css\jspsych.css" />
  </head>
  <body></body>
  <script>
    let timeline = [];

    images = [
      "https://c.files.bbci.co.uk/12A9B/production/_111434467_gettyimages-1143489763.jpg",
      "https://images.unsplash.com/photo-1545315171-cc80c905c252?ixlib=rb-1.2.1&w=1000&q=80",
      "https://api.time.com/wp-content/uploads/2015/02/cats.jpg?quality=85&w=1024&h=512&crop=1",
    ];

    // store all images names in an array of objects {'fileName': images[imag]}
    let container = {}; // main object
    timelineVariables = [];

    canvas = document.getElementById("jspsych-canvas-stimulus");

    //Constants
    const DOTS = [
      { x: 100, y: 100, content: "1" },
      { x: 200, y: 200, content: "2" },
      { x: 270, y: 210, content: "3" },
      { x: 180, y: 300, content: "4" },
      { x: 50, y: 90, content: "5" },
      { x: 400, y: 200, content: "6" },
    ];

    function drawDots(canvas, radius) {
      var ctx = canvas.getContext("2d");

      for (let i = 0; i < DOTS.length; i++) {
        console.log(i);
        let d = DOTS[i];
        ctx.beginPath();
        ctx.arc(d.x, d.y, radius, 0, 2 * Math.PI);
        // ctx.fillStyle = circle_color;
        // ctx.fill();
        ctx.closePath();
        ctx.stroke();
        // ctx.fillStyle = text_color; // font color to write the text with
        var text = d.content;
        var font = "bold " + radius + "px serif";
        ctx.font = font;
        ctx.textBaseline = "top";
        ctx.fillText(text, d.x - radius / 4, d.y - radius / 2);
      }
    }

    function circleCollision(c1, c2) {
      var a = c1.r + c2.r,
        x = c1.x - c2.x,
        y = c1.y - c2.y;

      if (a > Math.sqrt(x * x + y * y)) {
        return true;
      } else {
        return false;
      }
    }

    function checkForDot(e) {
      for (let i = 0; i < DOTS.length; i++) {
        let d = DOTS[i];
        let c1 = { x: d.x, y: d.y, r: 50 };
        let c2 = { x: e.pageX, y: e.pageY, r: 50 };
        console.log(c1);
        if (circleCollision(c1, c2)) {
          console.log("They are colliding!");
        }
      }
    }

    function filledCirc(canvas, left, right, radius, color) {
      var ctx = canvas.getContext("2d");
      ctx.beginPath();
      ctx.arc(left, right, radius, 0, 2 * Math.PI);
      ctx.fillStyle = color;
      ctx.fill();
    }

    var fullScreen = {
      type: "fullscreen",
      fullscreen_mode: true,
      message:
        "<p>El experimento ira a pantalla completa cuando usted presione el boton que se encuentra debajo</p><br>",
      button_label: "Continuar a pantalla completa",
    };

    let cm_resize = {
      type: "virtual-chinrest",
      blindspot_reps: 2,
      resize_units: "cm",
      pixels_per_unit: 50,
      item_path: "jspsych-6.3.0/examples/img/card.png",
    };

    let trial = {
      type: "canvas-button-response-modified",
      stimulus: function (c) {
        // Necesito hacer los 25 circulitos
        drawDots(c, 20);
      },
      prompt: "<p>What color is the circle?</p>",
      canvas_size: [700, 700],
      //   data: { color: "blue", radius: 100 },
    };

    // let trial2 = {
    //   type: "canvas-button-response",
    //   stimulus: function (c) {
    //     // Necesito hacer los 25 circulitos
    //     filledCirc(c, 150, 250, 100, "red");
    //     filledCirc(c, 250, 150, 100, "green");
    //     filledCirc(c, 250, 250, 100, "red");
    //   },
    //   prompt: "<p>What color is the circle?</p>",
    //   data: { color: "red", radius: 100 },
    // };

    // let trial3 = {
    //   type: "canvas-button-response",
    //   stimulus: function (c) {
    //     // Necesito hacer los 25 circulitos
    //     filledCirc(c, 250, 150, 100, "green");
    //   },
    //   prompt: "<p>What color is the circle?</p>",
    //   data: { color: "green", radius: 100 },
    // };

    jsPsych.init({
      timeline: [fullScreen, trial],

      // Image data should be preloaded
      preload_images: images,

      on_finish: function () {
        // Display data
        jsPsych.data.displayData();
      },
    });
  </script>
</html>
